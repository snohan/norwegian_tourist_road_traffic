---
title: "Nasjonale turistveger og trafikkmengde"
knit: (function(input_file, encoding){
  rmarkdown::render(input_file, encoding=encoding, output_file = 'docs/index.html')})
output: 
  html_document:
    css: svv.css
    number_sections: true
    toc: true
    toc_float: 
      collapsed: false
      smooth_scroll: false
    toc_depth: 4
---

```{r setup, include = FALSE, echo = FALSE, warning=FALSE, message=FALSE}
# Packages are loaded through sourcing rmd_setup.R
source("H:/Programmering/R/byindeks/rmd_setup.R")
```

```{r get_data}
# Load prepared data (avoiding fetching all data for every knit!)
tourist_road_names <- readRDS(file = "data/tourist_road_names.rds")

tourist_road_geometry <- readRDS(file = "data/tourist_road_geometry.rds")

trps_on_tourist_roads <- readRDS(file = "data/trps_on_tourist_roads.rds")

trp_mdt_wide <- readRDS(file = "data/trp_mdt_wide.rds")
trp_mdt_long <- readRDS(file = "data/trp_mdt_long.rds")
```

```{r functions}
create_mdt_plot <- function(trp_mdt_long_format, road_number) {
  
  trp_mdt_long_format %>% 
    dplyr::filter(Navn == tourist_road_names$Navn[road_number]) %>% 
    dplyr::select(-Navn) %>%
    dplyr::mutate(year = as.character(year)) %>% 
    ggplot2::ggplot(aes(x = month_object, y = mdt, color = year)) +
    ggplot2::geom_line() +
    ggplot2::geom_point() +
    ggplot2::facet_grid(rows = vars(name),
                        labeller = label_wrap_gen(width = 12)) +
    theme_light() +
    theme(axis.text.x = element_text(angle = 90),
          panel.grid.minor.x = element_blank(),
          strip.text.y = element_text(angle = 90)) +
    scale_x_date(breaks = scales::breaks_width("months"),
                 labels = scales::label_date("%b")) +
    scale_color_manual(values = c("2019" = "#008ec2",
                                  "2020" = "#ed9300"#,
                                  #"tunge" = "#444f55"
                                  ),
                       name = "År") +
    labs(x = NULL, y = "Månedsdøgntrafikk \n",
         caption = "Data: Statens vegvesen og fylkeskommunene") +
    ggtitle("Gjennomsnittlig antall kjøretøy per dag",
            subtitle = "") +
    theme(legend.position = "bottom")  
}


```

```{r tourist_road_map}

```


Det er `r nrow(tourist_road_names)` Nasjonale turistveger i Norge. Denne rapporten tar for seg trafikkutviklingen de siste årene, med spesielt fokus på sommertrafikken (juni - august). 

Øvrig informasjom om turistvegene på finnes på [www.nasjonaleturistveger.no](https://www.nasjonaleturistveger.no/).


```{r tourist_road_table}
#tourist_road_names %>% 
trps_on_tourist_roads %>% 
  dplyr::select(Turistveg = Navn, lengde = lokasjon.lengde, n_trps) %>% 
  dplyr::distinct() %>% 
  dplyr::arrange(Turistveg) %>% 
  dplyr::mutate(lengde = lengde / 1000) %>% 
  flextable::flextable() %>% 
  fontsize(size = 11, part = "all") %>% 
  set_header_labels(Turistveg = "Nasjonal turistveg",
                    lengde = "Lengde\n (km)",
                    n_trps = "Antall trafikk-\n registreringspunkt") %>% 
  colformat_double(j = 2, digits = 0) %>% 
  bold(part = "header") %>%
  bg(bg = "#ED9300", part = "header") %>%
  border_remove() %>%
  hline_top(part = "header", border = borderline) %>%
  hline_bottom(part = "all", border = borderline) %>%
  padding(padding.top = .5,
          padding.bottom = .3,
          part = "body") %>% 
  set_table_properties(width = .45, 
                       layout = "autofit") %>% 
  autofit(add_h = 0.2) %>%
  #height_all(height = 5, part = "body") %>%
  set_caption(caption = "Nasjonale turistveger.")
```


# `r tourist_road_names$Navn[1]`

```{r tourist_road_table_1}
# caption_text <- paste0("Gjennomsnittlig daglig antall kjøretøy ved utvalgte punkter på Nasjonal turistveg ",
#                        tourist_road_names$Navn[1], ".")
# 
# trp_mdt_wide %>% 
#   dplyr::filter(Navn == tourist_road_names$Navn[1]) %>% 
#   dplyr::select(-Navn) %>% 
#   flextable::flextable() %>%
#   set_header_labels(name = "Sted",
#                     road_category_and_number = "Veg",
#                     year = "År") %>% 
#   colformat_int(j = 3, big.mark = "") %>% 
#   bold(part = "header") %>%
#   bg(bg = "#ED9300", part = "header") %>%
#   border_remove() %>%
#   hline_top(part = "header", border = borderline) %>%
#   hline_bottom(part = "all", border = borderline) %>%
#   padding(padding.top = .5,
#           padding.bottom = .3,
#           part = "body") %>% 
#   #set_table_properties(width = .25, 
#   #                     layout = "autofit") %>% 
#   autofit(add_h = 0.2) %>%
#   #height_all(height = 5, part = "body") %>%
#   set_caption(caption = caption_text)


# Looking at just summer months 6-8.
# TODO: sdt summer 2019, 2020
# TODO: pointindex 2019-2020, 2020-2021, 2019-2021
# TODO: pointindex 2021
```

```{r plot_1, fig.width=5.5, fig.height=5}
create_mdt_plot(trp_mdt_long, 1)
```



# `r tourist_road_names$Navn[2]`

```{r plot_2, fig.width=5.5, fig.height=5}
create_mdt_plot(trp_mdt_long, 2)
```


# `r tourist_road_names$Navn[3]`

```{r plot_3, fig.width=5.5, fig.height=4}
create_mdt_plot(trp_mdt_long, 3)
```



# `r tourist_road_names$Navn[4]`

```{r plot_4, fig.width=5.5, fig.height=3}
create_mdt_plot(trp_mdt_long, 4)
```



# `r tourist_road_names$Navn[5]`

```{r plot_5, fig.width=5.5, fig.height=3}
create_mdt_plot(trp_mdt_long, 5)
```



# `r tourist_road_names$Navn[6]`

```{r plot_6, fig.width=5.5, fig.height=11}
create_mdt_plot(trp_mdt_long, 6)
```



# `r tourist_road_names$Navn[7]`

```{r plot_7, fig.width=5.5, fig.height=8}
create_mdt_plot(trp_mdt_long, 7)
```



# `r tourist_road_names$Navn[8]`

```{r plot_8, fig.width=5.5, fig.height=5}
create_mdt_plot(trp_mdt_long, 8)
```



# `r tourist_road_names$Navn[9]`

```{r plot_9, fig.width=5.5, fig.height=3}
create_mdt_plot(trp_mdt_long, 9)
```



# `r tourist_road_names$Navn[10]`

```{r plot_10, fig.width=5.5, fig.height=14}
create_mdt_plot(trp_mdt_long, 10)
```



# `r tourist_road_names$Navn[11]`

```{r plot_11, fig.width=5.5, fig.height=7}
create_mdt_plot(trp_mdt_long, 11)
```



# `r tourist_road_names$Navn[12]`

```{r plot_12, fig.width=5.5, fig.height=16}
create_mdt_plot(trp_mdt_long, 12)
```



# `r tourist_road_names$Navn[13]`

```{r plot_13, fig.width=5.5, fig.height=5}
create_mdt_plot(trp_mdt_long, 13)
```


# `r tourist_road_names$Navn[14]`

```{r plot_14, fig.width=5.5, fig.height=16}
create_mdt_plot(trp_mdt_long, 14)
```



# `r tourist_road_names$Navn[15]`

```{r plot_15, fig.width=5.5, fig.height=5}
create_mdt_plot(trp_mdt_long, 15)
```



# `r tourist_road_names$Navn[16]`

```{r plot_16, fig.width=5.5, fig.height=5}
create_mdt_plot(trp_mdt_long, 16)
```



# `r tourist_road_names$Navn[17]`

```{r plot_17, fig.width=5.5, fig.height=4}
create_mdt_plot(trp_mdt_long, 17)
```


# `r tourist_road_names$Navn[18]`

```{r plot_18, fig.width=5.5, fig.height=7}
create_mdt_plot(trp_mdt_long, 18)
```


